<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>√Åbreme üíñ</title>

<style>
  :root{
    --red:#e63946;
    --pink:#ff4d6d;
    --gray:#adb5bd;
    --card:#ffffff;
    --shadow: 0 18px 50px rgba(0,0,0,.22);
  }
  *{box-sizing:border-box}

  body{
    margin:0;height:100vh;overflow:hidden;
    display:flex;align-items:center;justify-content:center;
    font-family: Arial, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    text-align:center;
    background: linear-gradient(135deg, #ff9a9e, #fad0c4, #ffc3a0, #ffb3c6);
    background-size: 400% 400%;
    animation: bgmove 10s ease-in-out infinite;
    position:relative;
  }
  @keyframes bgmove{
    0%{background-position:0% 50%}
    50%{background-position:100% 50%}
    100%{background-position:0% 50%}
  }

  .glow{
    position:absolute; inset:-40px;
    background: radial-gradient(circle at 20% 20%, rgba(255,255,255,.35), transparent 45%),
                radial-gradient(circle at 80% 30%, rgba(255,255,255,.22), transparent 50%),
                radial-gradient(circle at 50% 85%, rgba(255,255,255,.18), transparent 55%);
    filter: blur(10px);
    pointer-events:none;
  }

  .container{
    width:min(440px, 92vw);
    background: var(--card);
    padding: 34px 22px;
    border-radius: 22px;
    box-shadow: var(--shadow);
    position:relative;
    z-index:2;

    /* Transici√≥n global del ‚Äúcard‚Äù */
    transform: translateY(0) scale(1);
    opacity:1;
    transition: opacity .35s ease, transform .35s ease;
    will-change: transform, opacity;
  }

  /* estados para transiciones */
  .fadeOut{
    opacity:0;
    transform: translateY(10px) scale(.985);
  }
  .fadeIn{
    opacity:1;
    transform: translateY(0) scale(1);
  }

  h1{ margin:0 0 10px; color: var(--red); letter-spacing:.2px; }
  .sub{ margin: 0 0 16px; color:#666; line-height:1.35; }

  .nombre{
    font-size: 28px; font-weight: 800; color: var(--pink);
    margin: 6px 0 14px;
    text-shadow: 0 6px 18px rgba(255,77,109,.25);
    animation: shimmer 2.2s ease-in-out infinite;
    will-change: transform;
  }
  @keyframes shimmer{
    0%,100%{ transform: translateY(0); filter: saturate(1); }
    50%{ transform: translateY(-1px); filter: saturate(1.15); }
  }

  .pill{
    display:inline-flex; gap:8px; align-items:center; justify-content:center;
    padding: 10px 12px; border-radius: 999px;
    background: rgba(255,77,109,.10); color:#7a3a46;
    font-size: 13px; margin: 0 0 16px;
  }

  .mini{ font-size: 12px; color:#8a8a8a; margin-top: 10px; line-height:1.25; }

  button{
    padding: 14px 24px;
    font-size: 18px;
    border: none;
    border-radius: 14px;
    cursor: pointer;
    margin: 10px;
    transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
    user-select:none;
    box-shadow: 0 10px 18px rgba(0,0,0,.12);
    will-change: transform;
  }
  button:active{ transform: translateY(1px) scale(.99); }
  button:hover{ transform: translateY(-1px); box-shadow: 0 14px 26px rgba(0,0,0,.16); }

  #play{
    background: linear-gradient(135deg, var(--pink), #ff7aa2);
    color: white;
    font-size: 20px;
    padding: 14px 26px;
    border-radius: 16px;
    animation: breathe 1.5s ease-in-out infinite;
  }
  @keyframes breathe{
    0%,100%{ transform: scale(1); filter: brightness(1); }
    50%{ transform: scale(1.03); filter: brightness(1.03); }
  }

  #si{
    background: linear-gradient(135deg, var(--red), var(--pink));
    color: white;
    animation: heartBeat 1.3s ease-in-out infinite;
  }
  @keyframes heartBeat{
    0%,100%{ transform: scale(1); }
    50%{ transform: scale(1.03); }
  }

  /* El NO escapista, pero con movimiento suave */
  #no{
    background: linear-gradient(135deg, #b9c0c7, var(--gray));
    color: white;
    position: fixed;
    left: 50%;
    top: 50%;
    transform: translate3d(-50%, -50%, 0);
    z-index: 4;
    display:none;

    transition: transform .22s ease;
    will-change: transform;
    touch-action: none;
  }

  .final{ font-size: 24px; color: var(--red); line-height: 1.25; margin: 6px 0 0; }
  .final strong{ color: var(--pink); }
  .loveLine{ margin-top: 14px; font-size: 13px; color:#6a6a6a; }

  /* floating hearts layer */
  .hearts{ position:absolute; inset:0; overflow:hidden; pointer-events:none; z-index:1; }
  .heart{
    position:absolute; opacity:.85;
    filter: drop-shadow(0 10px 18px rgba(0,0,0,.15));
    animation: floatUp linear forwards;
    will-change: transform, opacity;
  }
  @keyframes floatUp{
    0%{ transform: translate3d(0, 30px, 0) scale(.9) rotate(0deg); opacity:0; }
    10%{ opacity:.9; }
    100%{ transform: translate3d(0, -120vh, 0) scale(1.35) rotate(18deg); opacity:0; }
  }

  /* sparkles */
  .sparkles{ position:absolute; inset:0; pointer-events:none; z-index:1; }
  .sparkle{
    position:absolute; width:6px; height:6px; border-radius:50%;
    background: rgba(255,255,255,.95);
    box-shadow: 0 0 16px rgba(255,255,255,.9);
    opacity:0; animation: twinkle 2.4s ease-in-out infinite;
    will-change: transform, opacity;
  }
  @keyframes twinkle{
    0%,100%{ transform: scale(.6); opacity:0; }
    40%{ opacity:.85; }
    60%{ transform: scale(1.25); opacity:.2; }
  }

  #confettiCanvas{ position:absolute; inset:0; pointer-events:none; z-index:3; }

  /* Reduce motion (por si el tel√©fono lo tiene activado) */
  @media (prefers-reduced-motion: reduce){
    *{ animation: none !important; transition: none !important; }
  }
</style>
</head>

<body>
  <div class="glow"></div>
  <div class="hearts" id="hearts"></div>
  <div class="sparkles" id="sparkles"></div>
  <canvas id="confettiCanvas"></canvas>

  <audio id="musica" src="corazon.mp3" preload="auto"></audio>

  <div class="container fadeIn" id="contenido">
    <h1>Antes de empezar‚Ä¶ üíñ</h1>
    <div class="nombre">Gerita ‚ù§Ô∏è</div>
    <div class="pill">üîä Sube el volumen ‚Ä¢ üé∂ Parte favorita ‚Ä¢ ü•∫ Promesa bonita</div>
    <p class="sub">Toca <b>Play</b>‚Ä¶ y despu√©s dime la verdad con el coraz√≥n üíò</p>
    <button id="play">‚ñ∂ Play</button>
    <div class="mini">(Si tarda 1‚Äì2 seg, es normal: est√° cargando la canci√≥n üôà)</div>
    <div class="loveLine">Hecho con amor, sin posibilidad de escapar üòå</div>
  </div>

  <!-- Bot√≥n NO global -->
  <button id="no">No üíî</button>

<script>
  // ===== Helpers =====
  const audio = document.getElementById("musica");
  const contenido = document.getElementById("contenido");
  const btnNoGlobal = document.getElementById("no");

  const START_SECONDS = 90; // 1:30
  let tama√±o = 1;

  const heartsLayer = document.getElementById("hearts");
  const sparklesLayer = document.getElementById("sparkles");
  const heartChars = ["‚ù§Ô∏è","üíñ","üíï","üíò","üíù","üíó","üíû"];

  function rand(min, max){ return Math.random() * (max - min) + min; }

  // Transici√≥n: fade out -> cambiar contenido -> fade in
  async function swapScreen(html){
    contenido.classList.add("fadeOut");
    contenido.classList.remove("fadeIn");

    // esperar el final de la transici√≥n (350ms)
    await new Promise(r => setTimeout(r, 360));

    contenido.innerHTML = html;

    // peque√±o frame para que el navegador aplique el DOM antes de animar
    requestAnimationFrame(() => {
      contenido.classList.remove("fadeOut");
      contenido.classList.add("fadeIn");
    });
  }

  // Audio seguro
  async function iniciarMusica(){
    try{
      if (audio.readyState < 1) {
        await new Promise(resolve => {
          const t = setTimeout(resolve, 1200);
          audio.addEventListener("loadedmetadata", () => { clearTimeout(t); resolve(); }, { once:true });
          audio.load();
        });
      }
      try { audio.currentTime = START_SECONDS; } catch(e) {}
      await audio.play();
    } catch(e) {}
  }

  // ===== Hearts =====
  function spawnHeart(){
    const heart = document.createElement("div");
    heart.className = "heart";
    heart.textContent = heartChars[Math.floor(Math.random()*heartChars.length)];
    heart.style.left = rand(0, 100) + "vw";
    heart.style.bottom = "-24px";
    heart.style.fontSize = rand(14, 26) + "px";
    heart.style.animationDuration = rand(6.0, 10.5) + "s";
    heart.style.opacity = rand(.35, .95);
    heartsLayer.appendChild(heart);

    const life = parseFloat(heart.style.animationDuration) * 1000;
    setTimeout(() => heart.remove(), life);
  }

  function burstHearts(n=12){
    for(let i=0;i<n;i++){
      setTimeout(spawnHeart, i*38);
    }
  }

  // Menos cantidad = m√°s fluido
  setInterval(() => {
    if (document.visibilityState === "visible") spawnHeart();
  }, 520);

  // ===== Sparkles =====
  function createSparkles(count=16){
    sparklesLayer.innerHTML = "";
    for(let i=0;i<count;i++){
      const s = document.createElement("div");
      s.className = "sparkle";
      s.style.left = rand(5, 95) + "vw";
      s.style.top  = rand(5, 95) + "vh";
      s.style.animationDelay = rand(0, 2.2) + "s";
      s.style.transform = `scale(${rand(.6, 1.2)})`;
      sparklesLayer.appendChild(s);
    }
  }
  createSparkles(16);

  // ===== Confetti =====
  const canvas = document.getElementById("confettiCanvas");
  const ctx = canvas.getContext("2d");
  let confettiPieces = [];
  let confettiRunning = false;

  function resizeCanvas(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener("resize", () => {
    resizeCanvas();
    if (btnNoGlobal.style.display !== "none") moverNoSuave();
  });
  resizeCanvas();

  function makePiece(){
    const colors = ["#e63946","#ff4d6d","#ffd6e0","#ffffff","#ffb3c6","#fad0c4"];
    return {
      x: rand(0, canvas.width),
      y: rand(-canvas.height, 0),
      w: rand(6, 12),
      h: rand(8, 18),
      vx: rand(-1.8, 1.8),
      vy: rand(2.4, 5.0),
      rot: rand(0, Math.PI*2),
      vr: rand(-0.12, 0.12),
      color: colors[Math.floor(Math.random()*colors.length)],
      alpha: rand(0.7, 1)
    };
  }

  function launchConfetti(ms=1800){
    confettiPieces = [];
    const count = 140; // menos = m√°s fluido
    for(let i=0;i<count;i++) confettiPieces.push(makePiece());
    confettiRunning = true;
    const endAt = performance.now() + ms;

    function tick(now){
      if (!confettiRunning) return;
      ctx.clearRect(0,0,canvas.width,canvas.height);

      for (const p of confettiPieces){
        p.x += p.vx; p.y += p.vy; p.rot += p.vr;

        if (p.y > canvas.height + 20) p.y = rand(-120, -20);
        if (p.x < -20) p.x = canvas.width + 20;
        if (p.x > canvas.width + 20) p.x = -20;

        ctx.save();
        ctx.globalAlpha = p.alpha;
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);
        ctx.fillStyle = p.color;
        ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
        ctx.restore();
      }

      if (now < endAt) requestAnimationFrame(tick);
      else { confettiRunning = false; ctx.clearRect(0,0,canvas.width,canvas.height); }
    }
    requestAnimationFrame(tick);
  }

  // ===== NO escapista (suave) =====
  let targetX = 0, targetY = 0;

  function pickNoTarget(){
    const pad = 12;
    const w = btnNoGlobal.offsetWidth || 110;
    const h = btnNoGlobal.offsetHeight || 50;

    const maxX = window.innerWidth - w - pad;
    const maxY = window.innerHeight - h - pad;

    let x = Math.random() * maxX;
    let y = Math.random() * maxY;

    // empuja fuera del centro
    const cx = window.innerWidth/2;
    const cy = window.innerHeight/2;
    const dx = x - cx, dy = y - cy;
    if (Math.sqrt(dx*dx + dy*dy) < 140){
      x = (x + 200) % maxX;
      y = (y + 220) % maxY;
    }

    targetX = Math.max(pad, Math.min(maxX, x));
    targetY = Math.max(pad, Math.min(maxY, y));
  }

  function moverNoSuave(){
    // translate3d para movimiento fluido (sin tocar left/top)
    btnNoGlobal.style.transform = `translate3d(${targetX}px, ${targetY}px, 0)`;
  }

  function escaparNo(){
    pickNoTarget();
    moverNoSuave();
  }

  // ===== Screens =====
  async function showPregunta(){
    btnNoGlobal.style.display = "inline-block";
    // El bot√≥n NO empieza posicionado en 0,0 con translate; elegimos objetivo y movemos
    pickNoTarget();
    requestAnimationFrame(moverNoSuave);

    await swapScreen(`
      <h1>¬øQuieres ser mi San Valent√≠n? üíò</h1>
      <div class="nombre">Gerita ‚ù§Ô∏è</div>
      <div class="pill">üíû Te lo digo sin miedo: me encantas ‚Ä¢ ‚ú®</div>
      <p class="sub">
        Si dices que <b>s√≠</b>, prometo cuidarte bonito‚Ä¶<br>
        y hacer de ese d√≠a un recuerdo que se nos quede pegado üíñ
      </p>
      <div class="btnRow">
        <button id="si">S√≠ üíñ</button>
      </div>
      <div class="mini">Tip: el ‚ÄúNo‚Äù anda nervioso‚Ä¶ m√≠ralo üòà</div>
    `);

    const botonSi = document.getElementById("si");

    // NO huye al acercarse / tocar
    btnNoGlobal.onmouseenter = () => { escaparNo(); burstHearts(8); };
    btnNoGlobal.ontouchstart = (e) => { e.preventDefault(); escaparNo(); burstHearts(10); };

    // Si logran tocar NO (raro), crece el s√≠
    btnNoGlobal.onclick = () => {
      tama√±o += 0.35;
      botonSi.style.transform = `scale(${tama√±o})`;
      burstHearts(12);
      escaparNo();
    };

    botonSi.onclick = () => showFinal();
  }

  async function showFinal(){
    btnNoGlobal.style.display = "none";
    launchConfetti(2200);
    burstHearts(30);

    await swapScreen(`
      <h1 class="final">
        üíï <strong>Gerita</strong>, ya est√°‚Ä¶ ahora soy la persona m√°s feliz del mundo üíï<br><br>
        Te espero el <strong>s√°bado 14 de febrero</strong> para pasar
        el San Valent√≠n m√°s hermoso de todos ‚ù§Ô∏è‚ú®
      </h1>
      <div class="loveLine">P.D.: Esto ya es oficialmente una cita üòåüíò</div>
    `);
  }

  // ===== Play action =====
  document.getElementById("play").addEventListener("click", async (e) => {
    e.target.disabled = true;
    e.target.textContent = "üíñ Sonando...";
    await iniciarMusica();
    await showPregunta();
  });

  burstHearts(10);
</script>
</body>
</html>
